{{ define "main" }}
    <div class="talks-full-container">
        <div class="header">
            <h1>Talks</h1>
        </div>
        
        <!-- Year Navigation -->
        <nav class="year-nav">
          {{ $yearsMap := dict }}
          {{ range (where .Site.RegularPages "Section" "talks") }}
            {{ $yearsMap = merge $yearsMap (dict (string .Date.Year) true) }}
          {{ end }}
          {{ $years := slice }}
          {{ range $year, $_ := $yearsMap }}
            {{ $years = $years | append (int $year) }}
          {{ end }}
          {{ range sort $years "value" "desc" }}
            <a href="#year-{{ . }}" class="year-link">{{ . }}</a>
          {{ end }}
        </nav>
        
    {{ $talks := (where .Site.RegularPages "Section" "talks").ByDate.Reverse }}
    {{ $currentYear := 0 }}
    {{ range $talks }}
      {{ $talkYear := .Date.Year }}
      {{ if ne $talkYear $currentYear }}
        {{ if ne $currentYear 0 }}
          </div> <!-- Close previous year's grid -->
        {{ end }}
        <div class="year-section" id="year-{{ $talkYear }}">
          <h2 class="year-header">{{ $talkYear }}</h2>
        </div>
        <div class="talks-grid">
        {{ $currentYear = $talkYear }}
      {{ end }}
      <div class="talk-item">
        {{ $image := "" }}
        {{ if .Params.images }}
          {{ $image = index .Params.images 0 }}
        {{ else if .Params.image }}
          {{ $image = .Params.image }}
        {{ end }}
        
        {{ if $image }}
          <div class="talk-image">
            {{ if .Params.recording }}
              <a href="{{ .Params.recording }}" target="_blank" rel="noopener">
                <img src="{{ $image }}" alt="{{ .Title }}" class="talk-thumbnail">
                <div class="play-button">â–¶</div>
              </a>
            {{ else }}
              <img src="{{ $image }}" alt="{{ .Title }}" class="talk-thumbnail">
            {{ end }}
          </div>
        {{ end }}
        
        <div class="talk-content">
          <h3 class="talk-title">
            {{ .Title }}
            {{ with .Params.subtitle }}
              <span class="talk-subtitle">{{ . }}</span>
            {{ end }}
          </h3>
          
          <div class="talk-meta">
            <span class="talk-date">{{ .Date.Format "January 2, 2006" }}</span>
            {{ with .Params.venue }}
              <span class="talk-venue">{{ . }}</span>
            {{ end }}
          </div>
          
          {{ with .Params.achievement }}
            <div class="talk-achievement">
              ğŸ† {{ . }}
            </div>
          {{ end }}
          
          <div class="talk-links">
            {{ with .Params.recording }}
              <a href="{{ . }}" class="talk-link" target="_blank" rel="noopener">ğŸ“¹ Recording</a>
            {{ end }}
            {{ with .Params.slides }}
              <a href="{{ . }}" class="talk-link" target="_blank" rel="noopener">ğŸ“Š Slides</a>
            {{ end }}
          </div>
          
          {{ with .Content }}
            <div class="talk-description">
              {{ . }}
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}
    </div> <!-- Close final year's grid -->
  </div>
</div>
{{ end }}
